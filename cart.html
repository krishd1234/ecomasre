<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Cart and checkout - deka clouthess. Secure checkout for your order.">
  <title>Cart & Checkout | deka clouthess</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="banner">Free shipping on orders over ₹1000</div>

  <header class="header">
    <div class="header-inner container">
      <a href="index.html" class="logo">deka <span>clouthess</span></a>
      <nav class="nav-desktop">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="shop.html">Shop</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
      <div class="header-actions">
        <button class="search-toggle" aria-label="Search">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        </button>
        <a href="cart.html" class="cart-toggle cart-count">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
          <span class="badge" style="display: none;">0</span>
        </a>
        <button class="menu-toggle" aria-label="Menu"><span></span><span></span><span></span></button>
      </div>
    </div>
    <nav class="nav-mobile">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <div class="search-overlay">
    <button class="search-close" aria-label="Close">&times;</button>
    <form action="shop.html" method="get">
      <input type="search" name="q" placeholder="Search products..." autocomplete="off">
    </form>
  </div>

  <main class="cart-page">
    <div class="container">
      <h1 style="margin-bottom: 2rem;">Cart & Checkout</h1>

      <div id="cart-content">
        <!-- Filled by JS -->
      </div>

      <div id="checkout-section" style="display: none;">
        <h2 style="margin-top: 3rem; margin-bottom: 1.5rem;">Shipping & Payment</h2>
        <form class="checkout-form" id="checkout-form">
          <div class="form-group">
            <label>Email</label>
            <input type="email" name="email" required placeholder="your@email.com">
          </div>
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" name="name" required placeholder="John Doe">
          </div>
          <div class="form-group">
            <label>Address</label>
            <input type="text" name="address" required placeholder="Street, City, State">
          </div>
          <div class="form-group">
            <label>City</label>
            <input type="text" name="city" required placeholder="City">
          </div>
          <div class="form-group">
            <label>Postal Code</label>
            <input type="text" name="postal" required placeholder="PIN / Postal Code">
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" name="phone" required placeholder="+91 98765 43210">
          </div>
          <div class="form-group">
            <label>Payment Method</label>
            <div class="payment-options">
              <label class="payment-option">
                <input type="radio" name="payment" value="cod" checked>
                <span>Cash on Delivery (COD)</span>
                <small>Pay when your order is delivered</small>
              </label>
              <label class="payment-option">
                <input type="radio" name="payment" value="card">
                <span>Credit / Debit Card</span>
                <small>Pay securely online</small>
              </label>
            </div>
          </div>
          <div class="form-group" id="card-fields" style="display: none;">
            <label>Card Number</label>
            <input type="text" name="card" placeholder="4242 4242 4242 4242">
          </div>
          <div class="form-group" id="card-expiry-cvc" style="display: none;">
            <label>Expiry & CVC</label>
            <div style="display: flex; gap: 1rem;">
              <input type="text" name="expiry" placeholder="MM/YY" style="flex: 1;">
              <input type="text" name="cvc" placeholder="CVC" style="width: 100px;">
            </div>
          </div>
          <button type="submit" class="btn" style="margin-top: 1rem;">Place Order</button>
        </form>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-bottom">&copy; 2025 deka clouthess.</div>
    </div>
  </footer>

  <script src="js/data.js"></script>
  <script src="js/main.js"></script>
  <script>
    const cartContent = document.getElementById('cart-content');
    const checkoutSection = document.getElementById('checkout-section');
    const cart = typeof getCart === 'function' ? getCart() : [];

    function renderCart() {
      if (cart.length === 0) {
        cartContent.innerHTML = `
          <p style="text-align: center; padding: 4rem; color: var(--color-text-muted);">
            Your cart is empty. <a href="shop.html" style="text-decoration: underline;">Continue shopping</a>
          </p>
        `;
        checkoutSection.style.display = 'none';
        return;
      }

      let subtotal = 0;
      const rows = cart.map((item, i) => {
        const total = item.price * item.quantity;
        subtotal += total;
        return `
          <tr>
            <td><img src="${item.image}" alt="${item.name}" class="cart-item-img"></td>
            <td>
              <div class="cart-item-name">${item.name}</div>
              <div class="cart-item-variant">Size: ${item.size} × ${item.quantity}</div>
            </td>
            <td>₹${item.price}</td>
            <td>₹${total}</td>
            <td>
              <button type="button" class="cart-remove" data-index="${i}">Remove</button>
            </td>
          </tr>
        `;
      }).join('');

      const freeShippingMin = typeof FREE_SHIPPING_MIN !== 'undefined' ? FREE_SHIPPING_MIN : 1000;
      const shippingCost = typeof SHIPPING_COST !== 'undefined' ? SHIPPING_COST : 99;
      const shipping = subtotal >= freeShippingMin ? 0 : shippingCost;
      const total = subtotal + shipping;

      cartContent.innerHTML = `
        <table class="cart-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Details</th>
              <th>Price</th>
              <th>Total</th>
              <th></th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <div class="cart-summary">
          <h3>Order Summary</h3>
          <div class="cart-summary-row"><span>Subtotal</span><span>₹${subtotal}</span></div>
          <div class="cart-summary-row"><span>Shipping</span><span>${shipping === 0 ? 'Free' : '₹' + shipping}</span></div>
          <div class="cart-summary-row" style="font-weight: 700; margin-top: 0.5rem;"><span>Total</span><span>₹${total}</span></div>
          <a href="#checkout-section" class="btn" style="width: 100%; margin-top: 1.5rem; text-align: center;">Proceed to Checkout</a>
        </div>
      `;

      checkoutSection.style.display = 'block';

      cartContent.querySelectorAll('.cart-remove').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.dataset.index, 10);
          const newCart = cart.filter((_, i) => i !== idx);
          setCart(newCart);
          location.reload();
        });
      });
    }

    renderCart();

    // Payment method toggle
    const paymentRadios = document.querySelectorAll('input[name="payment"]');
    const cardFields = document.getElementById('card-fields');
    const cardExpiryCvc = document.getElementById('card-expiry-cvc');
    const cardInput = document.querySelector('input[name="card"]');
    const expiryInput = document.querySelector('input[name="expiry"]');
    const cvcInput = document.querySelector('input[name="cvc"]');

    function toggleCardFields() {
      const isCard = document.querySelector('input[name="payment"]:checked')?.value === 'card';
      cardFields.style.display = isCard ? 'block' : 'none';
      cardExpiryCvc.style.display = isCard ? 'block' : 'none';
      cardInput.required = isCard;
      expiryInput.required = isCard;
      cvcInput.required = isCard;
    }

    paymentRadios.forEach(r => r.addEventListener('change', toggleCardFields));
    toggleCardFields();

    document.getElementById('checkout-form')?.addEventListener('submit', (e) => {
      e.preventDefault();
      const payment = document.querySelector('input[name="payment"]:checked')?.value;
      const msg = payment === 'cod'
        ? 'Thank you for your order! Pay with cash when your order is delivered.'
        : 'Thank you for your order! (Demo – no payment processed)';
      alert(msg);
      setCart([]);
      location.href = 'index.html';
    });

    const menuToggle = document.querySelector('.menu-toggle');
    const navMobile = document.querySelector('.nav-mobile');
    if (menuToggle && navMobile) {
      menuToggle.addEventListener('click', () => {
        menuToggle.classList.toggle('active');
        navMobile.classList.toggle('active');
      });
    }
  </script>
</body>
</html>
